<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Para à Petit Prix - Vitamines & Compléments Alimentaires</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
      xintegrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link
      rel="stylesheet"
      href="/css/styles.css"
    />
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg"
      id="mainNavbar"
    >
      <div class="container">
        <a
          class="navbar-brand"
          href="#"
        >
          <img
            class="logo"
            src="../img/icon-512.png"
            alt=""
          />
          Para Petit Prix
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse"
          id="navbarNav"
        >
          <ul class="navbar-nav ms-auto">
            <li class="nav-item text-center">
              <a
                class="nav-link"
                aria-current="page"
                href="../home/"
                >HOME</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="/views/cheveux_beaute.html"
                >Soins de la peau & Cosmétiques</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="/views/cheveux_beaute.html"
                >Cheveux & Beauté</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link active"
                href="/views/Vitamines&Compléments-Alimentaires.html"
                >Vitamines & Compléments Alimentaires</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="#latest-medicines"
                >Maternité & Produits Bébé</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="#latest-medicines"
                >Hygiène & Soins Personnels</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="#latest-medicines"
                >Nutrition & Produits Minceur</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="#latest-medicines"
                >Huiles Essentielles & Aromathérapie</a
              >
            </li>
            <li class="nav-item text-center">
              <a
                class="nav-link"
                href="#latest-medicines"
                >Appareils & Accessoires Santé</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section
      id="latest-medicines"
      class="section-padding bg-light"
    >
      <div class="container">
        <div class="section-title">
          <h2>Vitamines & Compléments Alimentaires</h2>
        </div>
        <div
          class="row"
          id="productList"
        ></div>
      </div>
    </section>

    <footer class="footer">
      <div class="container">
        <div class="row">
          <!-- Présentation -->
          <div class="col-lg-4 col-md-6 mb-4 mb-lg-0">
            <h5><i class="fas fa-prescription-bottle-medical me-2"></i>Parapharmacie Petit Prix</h5>
            <p class="small">
              Votre partenaire de confiance pour une santé et un bien-être optimaux. Nous nous
              engageons à offrir des soins parapharmaceutiques de qualité, des conseils d’experts et
              une large gamme de produits de santé.
            </p>
          </div>

          <!-- Explorer -->
          <div class="col-lg-2 col-md-6 mb-4 mb-lg-0">
            <h5>Explorer</h5>
            <ul class="list-unstyled">
              <li><a href="#about">À propos</a></li>
              <li><a href="#services">Services</a></li>
              <li><a href="#products">Produits</a></li>
              <li><a href="#latest-medicines">Nouveautés</a></li>
              <li><a href="#offers">Offres</a></li>
            </ul>
          </div>

          <!-- Support -->
          <div class="col-lg-3 col-md-6 mb-4 mb-md-0">
            <h5>Support</h5>
            <ul class="list-unstyled">
              <li><a href="#faq">FAQ</a></li>
              <li><a href="#consultation">Prendre rendez-vous</a></li>
              <li><a href="#contact">Contactez-nous</a></li>
              <li><a href="#">Politique de confidentialité</a></li>
              <li><a href="#">Conditions d’utilisation</a></li>
            </ul>
          </div>

          <!-- Réseaux sociaux -->
          <div class="col-lg-3 col-md-6">
            <h5>Suivez-nous</h5>
            <p class="small mb-2">
              Restez informé de nos actualités et conseils santé sur les réseaux sociaux.
            </p>
            <div class="social-icons">
              <a
                href="#"
                aria-label="Facebook"
                ><i class="fab fa-facebook-f"></i
              ></a>
              <a
                href="#"
                aria-label="Twitter"
                ><i class="fab fa-twitter"></i
              ></a>
              <a
                href="#"
                aria-label="Instagram"
                ><i class="fab fa-instagram"></i
              ></a>
              <a
                href="#"
                aria-label="LinkedIn"
                ><i class="fab fa-linkedin-in"></i
              ></a>
            </div>
          </div>
        </div>

        <!-- Copyright -->
        <div class="copyright">
          © <span id="currentYear"></span> Parapharmacie Petit Prix. Tous droits réservés. Conçu
          avec <i class="fas fa-heart text-danger"></i> par
          <a
            href="#"
            target="_blank"
            rel="noopener noreferrer"
          >
            JOSEF UCCEF </a
          >.
        </div>
      </div>
    </footer>

    <!-- أيقونة السلة العائمة -->
    <div id="floating-cart">
      <i class="fas fa-shopping-cart"></i>
      <span id="cart-count">0</span>
    </div>

    <!-- نافذة السلة -->
    <div id="cart-popup">
      <button class="close-btn">&times;</button>
      <h4>🛒 Votre Panier</h4>
      <div id="cart-items"></div>
      <div id="cart-total">Total: 0 DH</div>
      <button id="whatsapp-btn">Envoyer via WhatsApp</button>
    </div>
    <script>
      // 🛒 السلة العالمية
      let cart = JSON.parse(localStorage.getItem('cart')) || [];

      const cartIcon = document.getElementById('floating-cart');
      const cartPopup = document.getElementById('cart-popup');
      const closeBtn = document.querySelector('#cart-popup .close-btn');
      const cartCount = document.getElementById('cart-count');
      const cartItemsContainer = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const whatsappBtn = document.getElementById('whatsapp-btn');

      // تحديث واجهة السلة عند تحميل الصفحة
      updateCart();

      // فتح / إغلاق السلة
      cartIcon.addEventListener('click', () => cartPopup.classList.add('active'));
      closeBtn.addEventListener('click', () => cartPopup.classList.remove('active'));

      // تحميل المنتجات من API وعرضها
      async function loadProducts() {
        try {
          const res = await fetch('https://para-petit-prix.vercel.app/api/products');
          const products = await res.json();

          const container = document.getElementById('productList');
          container.innerHTML = '';

          products.forEach((p) => {
            // ✅ نعرض فقط المنتجات لي عندها visibilité = "oui" و كاتيجوري = cheveux_beaute
            if (p.visibility !== 'oui' || p.category !== 'Vitamines & Compléments Alimentaires')
              return;

            const card = document.createElement('div');
            card.className = 'col-md-6 col-lg-3 mb-4';

            const imageUrl =
              p.image && p.image.trim() !== ''
                ? p.image
                : 'https://i.postimg.cc/MTVhPR2k/Logo-Wiz-30092025-183434.png';

            card.innerHTML = `
    <div class="medicine-card">
      <img src="${imageUrl}" alt="${p.name}" />
      <div class="card-body">
        <h5 class="card-title">${p.name}</h5>
        <p class="card-text text-muted">${
          p.description && p.description.trim() !== ''
            ? p.description
            : p.category
            ? p.category.replace('_', ' ')
            : 'Sans description'
        }</p>
        <p class="price">${Number(p.price).toFixed(2)} DH</p>
        <p class="stock">Stock : <span>${p.quantity}</span></p>
        <a href="#"
           class="btn btn-outline-primary btn-sm w-100 add-to-cart"
           data-title="${p.name}"
           data-price="${Number(p.price)}"
           data-img="${imageUrl}">
          <i class="fas fa-cart-plus me-2"></i> Ajouter au panier
        </a>
      </div>
    </div>
  `;
            container.appendChild(card);
          });

          // ✅ ربط كل زر مع السلة
          document.querySelectorAll('.add-to-cart').forEach((btn) => {
            btn.addEventListener('click', (e) => {
              e.preventDefault();
              const title = btn.getAttribute('data-title');
              const price = parseFloat(btn.getAttribute('data-price'));
              const imgSrc = btn.getAttribute('data-img');
              addToCart(title, price, imgSrc);
            });
          });
        } catch (err) {
          console.error('Erreur de chargement des produits:', err);
        }
      }

      // 🛒 إضافة منتج للسلة
      function addToCart(title, price, imgSrc) {
        const existing = cart.find((item) => item.title === title);
        if (existing) {
          existing.qty++;
        } else {
          cart.push({ title, price, qty: 1, imgSrc });
        }

        // حفظ السلة في localStorage
        localStorage.setItem('cart', JSON.stringify(cart));

        // تحديث واجهة السلة
        updateCart();
      }

      // تحديث واجهة السلة
      function updateCart() {
        cartCount.innerText = cart.reduce((acc, item) => acc + item.qty, 0);
        cartItemsContainer.innerHTML = '';

        cart.forEach((item, index) => {
          const div = document.createElement('div');
          div.className = 'cart-item d-flex align-items-center mb-2';
          div.innerHTML = `
        <img src="${item.imgSrc}" alt="${
          item.title
        }" style="width:60px; height:60px; object-fit:cover; margin-right:10px;">
        <div class="cart-item-details flex-grow-1">
          <span>${item.title} x${item.qty}</span><br>
          <span>${(item.price * item.qty).toFixed(2)} DH</span>
        </div>
        <button data-index="${index}" class="btn btn-sm btn-danger">&times;</button>
      `;
          cartItemsContainer.appendChild(div);

          div.querySelector('button').addEventListener('click', () => {
            cart.splice(index, 1);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCart();
          });
        });

        const total = cart.reduce((acc, item) => acc + item.price * item.qty, 0);
        cartTotal.innerText = `Total: ${total.toFixed(2)} DH`;
      }

      // إرسال الطلب عبر واتساب
      whatsappBtn.addEventListener('click', () => {
        if (cart.length === 0) return alert('Votre panier est vide !');
        let message = 'Bonjour, je souhaite commander :%0A';
        cart.forEach((item) => {
          message += `- ${item.title} x${item.qty} : ${(item.price * item.qty).toFixed(2)} DH%0A`;
        });
        const total = cart.reduce((acc, item) => acc + item.price * item.qty, 0);
        message += `Total: ${total.toFixed(2)} DH`;

        const whatsappNumber = '212601862102';
        window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
      });

      document.addEventListener('DOMContentLoaded', loadProducts);
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="/js/script.js"></script>
  </body>
</html>
